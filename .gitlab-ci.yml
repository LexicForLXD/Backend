image: janrtr/docker-phpunit-php7:7.1-phpunit6
 
stages:
  - test
  - deploy

# Select what we should cache
cache:
  paths:
  - vendor/

services:
  - postgres:latest

variables:
  POSTGRES_DB: syp-lxc
  POSTGRES_USER: runner
  POSTGRES_PASSWORD: "test"

test:php7.1:
  stage: test
  before_script:
  - composer install
  script:
    - phpunit --coverage-text

test:php7.0:
  stage: test
  image: janrtr/docker-phpunit-php7:7.0-phpunit6
  before_script:
  - composer install
  script:
    - phpunit --coverage-text

deploy:dev:
  image: byrnedo/alpine-curl
  stage: deploy
  script:
    # Trigger deploy webhook with secret
    - curl "https://lxd-api.lleon.de/"
  when: on_success

